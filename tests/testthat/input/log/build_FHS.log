
  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   16.1   Copyright 1985-2019 StataCorp LLC
  Statistics/Data analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        https://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

Stata license: 120-user network perpetual
Serial number: 401606201670
  Licensed to: Brown University
               Brown University

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. Maximum number of variables is set to 5,000; see help set_maxvar.

. do "code\build_FHS.do" 

. clear all

. version 15

. set more off

. 
. program main
  1.     local indir  "../../../examples/source/raw/eventstudy_illustration_dat
> a/orig"
  2.     local outdir "."
  3. 
.     use "`indir'/simulation_data_dynamic.dta", clear
  4. 
.     local G 1
  5.     local LG 2
  6.     local M 1
  7.     local LM 2
  8.     local furthest_lead = `G' + `LG'
  9.     local furthest_lag  = `M' + `LM'
 10.     local M_minus1 = `M' - 1
 11.     local furthest_lag_minus1 = `furthest_lag' - 1
 12. 
.     xtset id t
 13.     gen z_fd = d.z
 14. 
.     forvalues i = 2/`furthest_lead' {
 15.         gen z_fd_lead`i' = f`i'.z_fd
 16.     }
 17.     forvalues i = 1/`furthest_lag_minus1' {
 18.         gen z_fd_lag`i' = l`i'.z_fd
 19.     }
 20.     gen z_lead`furthest_lead' = f`furthest_lead'.z
 21.     gen z_lag`furthest_lag' = l`furthest_lag'.z
 22. 
.     run_regressions
 23. 
.     esttab * using "`outdir'/df_test_base_STATA_FHS.csv", csv plain wide noob
> s ///
>         keep(z_lead3 z_fd_lead2 z_fd z_fd_lag1 z_fd_lag2 z_lag3 x_r eta_m) //
> /
>         replace se nomtitles collabels("coef" "std_error") 
 24. end

. 
. program run_regressions
  1. 
.     * Case 2: FE=TRUE , TFE=TRUE , cluster=TRUE
.     eststo: xtivreg y_base x_r (eta_m = z_fd_lead3) z_lead3 z_fd_lead2 z_fd z
> _fd_lag1 z_fd_lag2 z_lag3 i.t, fe vce(cluster id)
  2. 
.     * Case 4: FE=TRUE , TFE=FALSE, cluster=TRUE
.     eststo: xtivreg y_base x_r (eta_m = z_fd_lead3) z_lead3 z_fd_lead2 z_fd z
> _fd_lag1 z_fd_lag2 z_lag3, fe vce(cluster id)
  3. 
.     * Case 5: FE=FALSE, TFE=TRUE , cluster=FALSE
.     eststo: ivregress 2sls y_base x_r (eta_m = z_fd_lead3) z_lead3 z_fd_lead2
>  z_fd z_fd_lag1 z_fd_lag2 z_lag3 i.t, small vce(robust)
  4. 
.     * Case 6: FE=FALSE, TFE=TRUE , cluster=TRUE
.     eststo: ivregress 2sls y_base x_r (eta_m = z_fd_lead3) z_lead3 z_fd_lead2
>  z_fd z_fd_lag1 z_fd_lag2 z_lag3 i.t, small vce(cluster id)
  5. 
.     * Case 7: FE=FALSE, TFE=FALSE, cluster=FALSE
.     eststo: ivregress 2sls y_base x_r (eta_m = z_fd_lead3) z_lead3 z_fd_lead2
>  z_fd z_fd_lag1 z_fd_lag2 z_lag3, small vce(robust)
  6. 
.     * Case 8: FE=FALSE, TFE=FALSE, cluster=TRUE
.     eststo: ivregress 2sls y_base x_r (eta_m = z_fd_lead3) z_lead3 z_fd_lead2
>  z_fd z_fd_lag1 z_fd_lag2 z_lag3, small vce(cluster id)
  7. 
. end

. 
. 
. main
       panel variable:  id (strongly balanced)
        time variable:  t, 1 to 40
                delta:  1 unit
(50 missing values generated)
(100 missing values generated)
(150 missing values generated)
(100 missing values generated)
(150 missing values generated)
(150 missing values generated)
(150 missing values generated)

Fixed-effects (within) IV regression            Number of obs     =      1,700
Group variable: id                              Number of groups  =         50

R-sq:                                           Obs per group:
     within  = 0.0234                                         min =         34
     between = 0.0002                                         avg =       34.0
     overall = 0.0235                                         max =         34


                                                Wald chi2(41)     =     563.53
corr(u_i, Xb)  = -0.0068                        Prob > chi2       =     0.0000

                                    (Std. Err. adjusted for 50 clusters in id)
------------------------------------------------------------------------------
             |               Robust
      y_base |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       eta_m |   1.669717     2.2977     0.73   0.467    -2.833692    6.173125
         x_r |  -.0500838    .028236    -1.77   0.076    -.1054253    .0052577
     z_lead3 |   .0456388   .2185155     0.21   0.835    -.3826437    .4739212
  z_fd_lead2 |    .020128   .1406527     0.14   0.886    -.2555462    .2958022
        z_fd |   .4703923   .6147443     0.77   0.444    -.7344843    1.675269
   z_fd_lag1 |   1.039846   1.085427     0.96   0.338    -1.087552    3.167244
   z_fd_lag2 |   1.355806    1.53003     0.89   0.376    -1.642998     4.35461
      z_lag3 |   1.889111   2.380558     0.79   0.427    -2.776697    6.554919
             |
           t |
          5  |  -.1445618    .145059    -1.00   0.319    -.4288723    .1397487
          6  |  -.1804222   .1413796    -1.28   0.202    -.4575211    .0966767
          7  |    .072028   .1290879     0.56   0.577    -.1809796    .3250356
          8  |  -.0322851   .1283444    -0.25   0.801    -.2838356    .2192653
          9  |   .0041491   .1374668     0.03   0.976    -.2652808    .2735791
         10  |   -.051398   .1280245    -0.40   0.688    -.3023214    .1995254
         11  |   .1143548   .1286828     0.89   0.374    -.1378587    .3665684
         12  |   .0273191   .1434449     0.19   0.849    -.2538278    .3084659
         13  |   .2037214   .1354581     1.50   0.133    -.0617715    .4692144
         14  |   .0983836   .1742024     0.56   0.572    -.2430467     .439814
         15  |  -.0035765   .1432341    -0.02   0.980    -.2843101    .2771571
         16  |   .2188169   .1326667     1.65   0.099    -.0412051    .4788389
         17  |   .1806428   .1430766     1.26   0.207    -.0997822    .4610677
         18  |   .0470048   .1451781     0.32   0.746    -.2375391    .3315487
         19  |   .1228036   .1455141     0.84   0.399    -.1623988    .4080059
         20  |   .0783397   .1549445     0.51   0.613     -.225346    .3820254
         21  |  -.0106512   .1479249    -0.07   0.943    -.3005786    .2792763
         22  |   .1017979    .156011     0.65   0.514    -.2039781    .4075739
         23  |   .0087443   .1413288     0.06   0.951    -.2682551    .2857436
         24  |   .1678217   .1471197     1.14   0.254    -.1205275    .4561709
         25  |   .1108294   .1411038     0.79   0.432     -.165729    .3873877
         26  |   .2129903   .1380164     1.54   0.123     -.057517    .4834975
         27  |    .031617   .1651823     0.19   0.848    -.2921344    .3553683
         28  |  -.0867771   .1482848    -0.59   0.558      -.37741    .2038558
         29  |   .1880814   .1544191     1.22   0.223    -.1145745    .4907372
         30  |   .0273953   .1542155     0.18   0.859    -.2748615     .329652
         31  |  -.1096336   .1888709    -0.58   0.562    -.4798138    .2605466
         32  |   .0228604   .1843668     0.12   0.901    -.3384919    .3842127
         33  |   .0984107   .1614641     0.61   0.542     -.218053    .4148745
         34  |    .030549   .1706261     0.18   0.858     -.303872      .36497
         35  |  -.0596031   .1545031    -0.39   0.700    -.3624237    .2432175
         36  |   .3208422   .1893818     1.69   0.090    -.0503393    .6920238
         37  |  -.0497076   .1660158    -0.30   0.765    -.3750927    .2756774
             |
       _cons |  -.2670967    .421563    -0.63   0.526    -1.093345    .5591515
-------------+----------------------------------------------------------------
     sigma_u |  .12876646
     sigma_e |   .7135176
         rho |  .03154113   (fraction of variance due to u_i)
------------------------------------------------------------------------------
Instrumented:   eta_m
Instruments:    x_r z_lead3 z_fd_lead2 z_fd z_fd_lag1 z_fd_lag2 z_lag3 5.t 6.t
                7.t 8.t 9.t 10.t 11.t 12.t 13.t 14.t 15.t 16.t 17.t 18.t 19.t
                20.t 21.t 22.t 23.t 24.t 25.t 26.t 27.t 28.t 29.t 30.t 31.t
                32.t 33.t 34.t 35.t 36.t 37.t z_fd_lead3
------------------------------------------------------------------------------
(est1 stored)

Fixed-effects (within) IV regression            Number of obs     =      1,700
Group variable: id                              Number of groups  =         50

R-sq:                                           Obs per group:
     within  =      .                                         min =         34
     between = 0.0309                                         avg =       34.0
     overall = 0.0025                                         max =         34


                                                Wald chi2(8)      =      10.89
corr(u_i, Xb)  = 0.0108                         Prob > chi2       =     0.2079

                                    (Std. Err. adjusted for 50 clusters in id)
------------------------------------------------------------------------------
             |               Robust
      y_base |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       eta_m |   1.948522   2.130648     0.91   0.360     -2.22747    6.124515
         x_r |  -.0533449   .0277989    -1.92   0.055    -.1078297    .0011399
     z_lead3 |   .0980764   .2460766     0.40   0.690    -.3842249    .5803777
  z_fd_lead2 |   .0128612   .1433497     0.09   0.929    -.2680991    .2938215
        z_fd |   .4809733   .5654271     0.85   0.395    -.6272435     1.58919
   z_fd_lag1 |   1.183739   1.008607     1.17   0.241    -.7930937    3.160571
   z_fd_lag2 |   1.547324   1.410691     1.10   0.273     -1.21758    4.312227
      z_lag3 |   2.202123     2.2346     0.99   0.324    -2.177613    6.581859
       _cons |  -.2797332    .372315    -0.75   0.452    -1.009457    .4499907
-------------+----------------------------------------------------------------
     sigma_u |  .12721849
     sigma_e |  .71576354
         rho |  .03062343   (fraction of variance due to u_i)
------------------------------------------------------------------------------
Instrumented:   eta_m
Instruments:    x_r z_lead3 z_fd_lead2 z_fd z_fd_lag1 z_fd_lag2 z_lag3
                z_fd_lead3
------------------------------------------------------------------------------
(est2 stored)
note: 1.t identifies no observations in the sample
note: 2.t identifies no observations in the sample
note: 3.t identifies no observations in the sample
note: 37.t omitted because of collinearity
note: 38.t identifies no observations in the sample
note: 39.t identifies no observations in the sample
note: 40.t identifies no observations in the sample

Instrumental variables (2SLS) regression          Number of obs   =      1,700
                                                  F( 41,  1658)   =       1.23
                                                  Prob > F        =     0.1538
                                                  R-squared       =     0.0234
                                                  Adj R-squared   =    -0.0008
                                                  Root MSE        =     .71432

------------------------------------------------------------------------------
             |               Robust
      y_base |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       eta_m |   1.634839   2.282194     0.72   0.474    -2.841447    6.111125
         x_r |  -.0488262   .0323695    -1.51   0.132    -.1123155    .0146631
     z_lead3 |   .0703236   .2541796     0.28   0.782    -.4282232    .5688703
  z_fd_lead2 |   .0163729   .1297879     0.13   0.900    -.2381925    .2709382
        z_fd |   .4654961   .6314258     0.74   0.461    -.7729799    1.703972
   z_fd_lag1 |   1.033747   1.082208     0.96   0.340    -1.088891    3.156385
   z_fd_lag2 |   1.343855   1.536298     0.87   0.382    -1.669434    4.357143
      z_lag3 |   1.870236   2.412257     0.78   0.438    -2.861154    6.601627
             |
           t |
          1  |          0  (empty)
          2  |          0  (empty)
          3  |          0  (empty)
          4  |   .0889157   .1399864     0.64   0.525    -.1856531    .3634845
          5  |  -.0566065   .1494298    -0.38   0.705    -.3496974    .2364844
          6  |  -.0935809   .1490491    -0.63   0.530    -.3859251    .1987633
          7  |   .1575666   .1358264     1.16   0.246    -.1088427     .423976
          8  |   .0526245   .1478737     0.36   0.722    -.2374144    .3426635
          9  |   .0884779   .1421941     0.62   0.534    -.1904209    .3673768
         10  |   .0316181   .1371254     0.23   0.818    -.2373391    .3005753
         11  |   .1957738    .144126     1.36   0.175    -.0869143     .478462
         12  |   .1078796   .1504975     0.72   0.474    -.1873056    .4030648
         13  |   .2836056   .1478851     1.92   0.055    -.0064557    .5736668
         14  |   .1773806   .1525294     1.16   0.245    -.1217899     .476551
         15  |   .0742261   .1428902     0.52   0.604    -.2060382    .3544903
         16  |   .2964916   .1529191     1.94   0.053    -.0034432    .5964265
         17  |   .2572347   .1483059     1.73   0.083    -.0336518    .5481212
         18  |     .12177   .1560263     0.78   0.435    -.1842594    .4277993
         19  |   .1966964    .145484     1.35   0.177    -.0886552     .482048
         20  |   .1506786   .1444086     1.04   0.297    -.1325638     .433921
         21  |   .0612472   .1435157     0.43   0.670    -.2202439    .3427384
         22  |   .1726651   .1500455     1.15   0.250    -.1216336    .4669638
         23  |   .0792813   .1378739     0.58   0.565     -.191144    .3497066
         24  |   .2370116   .1410541     1.68   0.093    -.0396513    .5136745
         25  |    .177562   .1419291     1.25   0.211    -.1008172    .4559412
         26  |   .2789722   .1335649     2.09   0.037     .0169985    .5409459
         27  |   .0970359   .1458574     0.67   0.506    -.1890481      .38312
         28  |  -.0229556   .1563154    -0.15   0.883     -.329552    .2836409
         29  |   .2491596   .1475503     1.69   0.091     -.040245    .5385642
         30  |   .0877066   .1369208     0.64   0.522    -.1808493    .3562625
         31  |  -.0517204   .1538452    -0.34   0.737    -.3534717     .250031
         32  |   .0793503   .1457496     0.54   0.586    -.2065223    .3652229
         33  |   .1538856    .139201     1.11   0.269    -.1191427    .4269138
         34  |   .0831373   .1354655     0.61   0.539    -.1825642    .3488388
         35  |   -.007319   .1386806    -0.05   0.958    -.2793264    .2646885
         36  |   .3707743   .1448634     2.56   0.011     .0866397    .6549088
         37  |          0  (omitted)
         38  |          0  (empty)
         39  |          0  (empty)
         40  |          0  (empty)
             |
       _cons |  -.3560256     .41589    -0.86   0.392     -1.17175    .4596992
------------------------------------------------------------------------------
Instrumented:  eta_m
Instruments:   x_r z_lead3 z_fd_lead2 z_fd z_fd_lag1 z_fd_lag2 z_lag3 4.t
               5.t 6.t 7.t 8.t 9.t 10.t 11.t 12.t 13.t 14.t 15.t 16.t 17.t
               18.t 19.t 20.t 21.t 22.t 23.t 24.t 25.t 26.t 27.t 28.t 29.t
               30.t 31.t 32.t 33.t 34.t 35.t 36.t z_fd_lead3
(est3 stored)
note: 1.t identifies no observations in the sample
note: 2.t identifies no observations in the sample
note: 3.t identifies no observations in the sample
note: 37.t omitted because of collinearity
note: 38.t identifies no observations in the sample
note: 39.t identifies no observations in the sample
note: 40.t identifies no observations in the sample

Instrumental variables (2SLS) regression          Number of obs   =      1,700
                                                  F( 41,    49)   =      13.85
                                                  Prob > F        =     0.0000
                                                  R-squared       =     0.0234
                                                  Adj R-squared   =    -0.0008
                                                  Root MSE        =     .71432

                                    (Std. Err. adjusted for 50 clusters in id)
------------------------------------------------------------------------------
             |               Robust
      y_base |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       eta_m |   1.634839   2.172034     0.75   0.455    -2.730027    5.999705
         x_r |  -.0488262   .0295303    -1.65   0.105    -.1081695    .0105171
     z_lead3 |   .0703236   .2390053     0.29   0.770    -.4099756    .5506227
  z_fd_lead2 |   .0163729   .1410474     0.12   0.908    -.2670725    .2998183
        z_fd |   .4654961   .5886608     0.79   0.433    -.7174621    1.648454
   z_fd_lag1 |   1.033747   1.037399     1.00   0.324    -1.050984    3.118477
   z_fd_lag2 |   1.343855   1.457308     0.92   0.361    -1.584715    4.272424
      z_lag3 |   1.870236   2.299706     0.81   0.420    -2.751195    6.491668
             |
           t |
          1  |          0  (empty)
          2  |          0  (empty)
          3  |          0  (empty)
          4  |   .0889157   .1380676     0.64   0.523    -.1885415    .3663729
          5  |  -.0566065   .1656037    -0.34   0.734    -.3893996    .2761866
          6  |  -.0935809   .1449406    -0.65   0.522    -.3848499    .1976881
          7  |   .1575666   .1390979     1.13   0.263     -.121961    .4370943
          8  |   .0526245   .1488727     0.35   0.725    -.2465464    .3517954
          9  |   .0884779   .1415386     0.63   0.535    -.1959545    .3729104
         10  |   .0316181    .133999     0.24   0.814     -.237663    .3008992
         11  |   .1957738   .1335156     1.47   0.149    -.0725359    .4640835
         12  |   .1078796   .1557949     0.69   0.492    -.2052019    .4209611
         13  |   .2836056   .1390135     2.04   0.047     .0042476    .5629636
         14  |   .1773806   .1504508     1.18   0.244    -.1249615    .4797227
         15  |   .0742261   .1256521     0.59   0.557    -.1782813    .3267334
         16  |   .2964916   .1519526     1.95   0.057    -.0088685    .6018518
         17  |   .2572347   .1516251     1.70   0.096    -.0474674    .5619367
         18  |     .12177   .1680909     0.72   0.472    -.2160213    .4595613
         19  |   .1966964   .1235343     1.59   0.118     -.051555    .4449478
         20  |   .1506786   .1505586     1.00   0.322    -.1518803    .4532375
         21  |   .0612472   .1473197     0.42   0.679    -.2348027    .3572972
         22  |   .1726651    .143527     1.20   0.235    -.1157633    .4610934
         23  |   .0792813   .1278617     0.62   0.538    -.1776664    .3362291
         24  |   .2370116   .1273546     1.86   0.069    -.0189171    .4929402
         25  |    .177562   .1482323     1.20   0.237    -.1203219    .4754459
         26  |   .2789722   .1319547     2.11   0.040     .0137994     .544145
         27  |   .0970359   .1537173     0.63   0.531    -.2118705    .4059424
         28  |  -.0229556   .1532708    -0.15   0.882    -.3309648    .2850537
         29  |   .2491596   .1569202     1.59   0.119    -.0661833    .5645026
         30  |   .0877066   .1177834     0.74   0.460     -.148988    .3244012
         31  |  -.0517204   .1568142    -0.33   0.743    -.3668503    .2634096
         32  |   .0793503    .154935     0.51   0.611    -.2320031    .3907038
         33  |   .1538856   .1445707     1.06   0.292      -.13664    .4444112
         34  |   .0831373   .1327945     0.63   0.534    -.1837232    .3499978
         35  |   -.007319   .1359091    -0.05   0.957    -.2804385    .2658005
         36  |   .3707743   .1300495     2.85   0.006     .1094301    .6321185
         37  |          0  (omitted)
         38  |          0  (empty)
         39  |          0  (empty)
         40  |          0  (empty)
             |
       _cons |  -.3560256   .4041814    -0.88   0.383    -1.168258    .4562072
------------------------------------------------------------------------------
Instrumented:  eta_m
Instruments:   x_r z_lead3 z_fd_lead2 z_fd z_fd_lag1 z_fd_lag2 z_lag3 4.t
               5.t 6.t 7.t 8.t 9.t 10.t 11.t 12.t 13.t 14.t 15.t 16.t 17.t
               18.t 19.t 20.t 21.t 22.t 23.t 24.t 25.t 26.t 27.t 28.t 29.t
               30.t 31.t 32.t 33.t 34.t 35.t 36.t z_fd_lead3
(est4 stored)

Instrumental variables (2SLS) regression          Number of obs   =      1,700
                                                  F(  8,  1691)   =       1.57
                                                  Prob > F        =     0.1296
                                                  R-squared       =          .
                                                  Adj R-squared   =          .
                                                  Root MSE        =     .71647

------------------------------------------------------------------------------
             |               Robust
      y_base |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       eta_m |    1.94113   2.235042     0.87   0.385    -2.442609    6.324869
         x_r |  -.0524275   .0322331    -1.63   0.104    -.1156485    .0107936
     z_lead3 |   .1105664   .2566083     0.43   0.667    -.3927368    .6138696
  z_fd_lead2 |   .0091793   .1303523     0.07   0.944    -.2464895    .2648481
        z_fd |   .4814239   .6164001     0.78   0.435    -.7275634    1.690411
   z_fd_lag1 |   1.187588   1.060234     1.12   0.263    -.8919201    3.267097
   z_fd_lag2 |   1.549578   1.504329     1.03   0.303    -1.400963     4.50012
      z_lag3 |   2.195865   2.363999     0.93   0.353    -2.440807    6.832538
       _cons |  -.2873858   .4010536    -0.72   0.474    -1.073999     .499228
------------------------------------------------------------------------------
Instrumented:  eta_m
Instruments:   x_r z_lead3 z_fd_lead2 z_fd z_fd_lag1 z_fd_lag2 z_lag3
               z_fd_lead3
(est5 stored)

Instrumental variables (2SLS) regression          Number of obs   =      1,700
                                                  F(  8,    49)   =       1.55
                                                  Prob > F        =     0.1639
                                                  R-squared       =          .
                                                  Adj R-squared   =          .
                                                  Root MSE        =     .71647

                                    (Std. Err. adjusted for 50 clusters in id)
------------------------------------------------------------------------------
             |               Robust
      y_base |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       eta_m |    1.94113   2.076632     0.93   0.355    -2.232018    6.114278
         x_r |  -.0524275   .0286475    -1.83   0.073    -.1099968    .0051419
     z_lead3 |   .1105664   .2469213     0.45   0.656    -.3856405    .6067733
  z_fd_lead2 |   .0091793   .1437379     0.06   0.949    -.2796728    .2980313
        z_fd |   .4814239    .553323     0.87   0.389    -.6305202    1.593368
   z_fd_lag1 |   1.187588   .9880124     1.20   0.235     -.797897    3.173074
   z_fd_lag2 |   1.549578   1.376885     1.13   0.266    -1.217377    4.316533
      z_lag3 |   2.195865    2.19404     1.00   0.322    -2.213223    6.604953
       _cons |  -.2873858   .3775225    -0.76   0.450    -1.046046     .471274
------------------------------------------------------------------------------
Instrumented:  eta_m
Instruments:   x_r z_lead3 z_fd_lead2 z_fd z_fd_lag1 z_fd_lag2 z_lag3
               z_fd_lead3
(est6 stored)
(output written to ./df_test_base_STATA_FHS.csv)

. 
end of do-file
